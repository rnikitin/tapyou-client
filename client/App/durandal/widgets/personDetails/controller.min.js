define(["require","exports","durandal/app","tasks/models/events","tasks/backend/signalR"],function(n,t,i,r,u){var f=i,e=r,o=u,s=function(){function n(n,t){this.settings={},this.tasks=ko.observableArray([]),this.person=ko.observable(),this.$container=$(n),$.extend(this.settings,t),this.person(this.settings.person),f.trigger(e.person.widgets.detailsOpen,this),this.load()}return n.prototype.viewAttached=function(n){this.$view=$(n),this.$view.slideDown(),this.$view.closest("li.item").addClass("on")},n.prototype.hide=function(){this.$view.closest("li.item.on").removeClass("on"),this.$view.slideUp(function(){$(this).remove()}),f.trigger(e.map.deselect,this.settings.person.Id)},n.prototype.sendTasksToPerson=function(){var n=this;this.person().AssignedCount=0,this.person.valueHasMutated(),f.trigger(e.page.loading),o.personsHub.server.sendTasksToPerson(this.settings.person.Id).done(function(t){f.trigger(e.page.loaded),t?n.load():f.trigger(e.app.error,"Невозможно достучаться до курьеров. Попробуйте позже!")})},n.prototype.load=function(){var n=this;f.trigger(e.page.loading),o.tasksHub.server.listTasksByPerson(this.settings.person.Id,this.settings.date.toDate()).done(function(t){ko.mapping.fromJS(t,{},n.tasks),n.notifyMap(),f.trigger(e.page.loaded)})},n.prototype.notifyMap=function(){var n=ko.toJS(this.tasks);f.trigger(e.map.tasksShowed,n,!0,this.settings.person.Id),f.trigger(e.map.personSelected,this.settings.person.Id)},n}();t.model=s})